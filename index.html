<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LVN HESI Compass Practice</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:system-ui;background:#0b0f1e;color:#eaeaf0}
header{padding:16px 24px;font-size:18px;font-weight:600;background:#11162c}
main{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
.panel{background:rgba(255,255,255,.05);border-radius:16px;padding:16px}
.choice{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.15)}
pre{white-space:pre-wrap}
button{margin-top:12px;padding:10px 14px;border-radius:10px;border:none;background:#7a5cff;color:#fff}
small{opacity:.7}
</style>
</head>
<body>
<header>
LVN HESI Compass Practice — Progressive NGN
<br><small id="status">Loading…</small>
</header>
<main>
<div class="panel">
<button onclick="nextQ()">Next</button>
</div>
<div class="panel">
<h2 id="q"></h2>
<pre id="case"></pre>
<div id="a"></div>
</div>
</main>
<script>
let CLUSTERS=[], cIdx=0, qIdx=0, tIdx=0;

function safeEntries(obj){
  if(!obj || typeof obj !== 'object') return [];
  return Object.entries(obj);
}

fetch("./questions.json")
.then(r=>r.json())
.then(data=>{
  CLUSTERS=data||[];
  document.getElementById("status").textContent =
    `Clusters loaded: ${CLUSTERS.length}`;
  render();
})
.catch(e=>{document.getElementById("status").textContent=e.message;});

function render(){
  if(!CLUSTERS.length) return;
  const cluster = CLUSTERS[cIdx];
  const timeline = Array.isArray(cluster.timeline) ? cluster.timeline : [];
  const phase = timeline[tIdx] || {};
  const q = (cluster.questions||[])[qIdx] || {};

  document.getElementById("q").textContent = q.stem || "NGN Question";

  const vitalsTxt = safeEntries(phase.vitals).map(e=>e.join(": ")).join("\n");
  const labsTxt = safeEntries(phase.labs).map(e=>e.join(": ")).join("\n");

  document.getElementById("case").textContent =
    `PATIENT (${cluster.topic||""})\n` +
    `Condition: ${(cluster.patient||{}).primary_condition||""}\n\n` +
    `PHASE: ${phase.phase||""}\n\nVITALS:\n${vitalsTxt}\n\nLABS:\n${labsTxt}`;

  const a = document.getElementById("a");
  a.innerHTML = "";

  if(q.choices && Array.isArray(q.choices)){
    q.choices.forEach(ch=>{
      const d=document.createElement("div");
      d.className="choice";
      d.textContent=ch;
      a.appendChild(d);
    });
  } else if(q.bowtie){
    a.innerHTML = `
      <div class="choice"><b>${q.bowtie.left_prompt||""}</b><br>${(q.bowtie.left_options||[]).join("<br>")}</div>
      <div class="choice"><b>${q.bowtie.center_prompt||""}</b><br>${(q.bowtie.center_options||[]).join("<br>")}</div>
      <div class="choice"><b>${q.bowtie.right_prompt||""}</b><br>${(q.bowtie.right_options||[]).join("<br>")}</div>
    `;
  }
}

function nextQ(){
  const cluster = CLUSTERS[cIdx] || {};
  const qs = cluster.questions || [];
  const tl = cluster.timeline || [];

  qIdx++;
  if(qIdx >= qs.length){
    qIdx = 0;
    tIdx++;
  }
  if(tIdx >= tl.length){
    tIdx = 0;
    cIdx = (cIdx+1) % CLUSTERS.length;
  }
  render();
}
</script>
</body>
</html>
